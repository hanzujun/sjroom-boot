<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="application/msword; charset=utf-8"/>
    <title>SwaggerToWord</title>
    <style type="text/css">
        .bg {
            background-color: gray;
        }

        table {
            table-layout: fixed;
        }

        tr {
            height: 20px;
            font-size: 12px;
        }

        td {
            overflow: hidden;
            word-break: break-all;
            word-wrap: break-word;
        }

        .myWidth {
            width: 100px;
            text-align: left;
            font-weight: bolder;
        }

        .myfont_weight {
            font-weight: bolder;
        }

        .specialHeight {
            /* height: 40px;*/
            height: auto;
        }

        .json_class {

        }
    </style>
</head>
<body>
<div style="width:800px; margin: 0 auto">
    <% for(var table in tables) {%>
    <div>
        <!--这个是类的说明-->
        <% if(table.titleVisable == 1) { %>
        <h2>${table.seqTitle}${table.title}</h2>
        <% } %>
        <!--这个是每个请求的说明，方便生成文档后进行整理-->
        <h3>${table.seqTag}${table.tag}</h3>
        <table border="1" cellspacing="0" cellpadding="0" width="100%">
            <tr class="bg myfont_weight">
                <td colspan="6">${table.tag}</td>
            </tr>
            <tr>
                <td class="myWidth">接口描述</td>
                <td colspan="5">${table.description}</td>
            </tr>
            <tr>
                <td class="myWidth">URL</td>
                <td colspan="5">${table.url}</td>
            </tr>
            <tr>
                <td class="myWidth">请求方式</td>
                <td colspan="5">${table.requestType}</td>
            </tr>
            <tr>
                <td class="myWidth">请求类型</td>
                <td colspan="5">${table.requestForm}</td>
            </tr>
            <tr>
                <td class="myWidth">返回类型</td>
                <td colspan="5">${table.responseForm}</td>
            </tr>
            <tr>
                <td class="myWidth">提供人</td>
                <td colspan="5">${table.author}</td>
            </tr>
            <tr>
                <td class="myWidth">接口响应时长</td>
                <td colspan="5">${table.responseTime}</td>
            </tr>
            <tr class="bg myfont_weight">
                <td colspan="6">请求参数列表</td>
            </tr>
            <tr class="bg" align="center">
                <td class="myWidth">参数</td>
                <td class="myfont_weight">参数类型</td>
                <td class="myfont_weight">字段限制</td>
                <td class="myfont_weight">字段说明</td>
                <td class="myfont_weight">说明</td>
                <td class="myfont_weight">备注</td>
            </tr>
            <% for(var request in table.requestList) { %>
            <tr align="center">
                <td class="myWidth">${request.parameter}</td>
                <td>${request.type}</td>
                <td>
                    <% if (request.require!= null && request.require) { %>
                    必填
                    <% } else { %>
                    可选
                    <% } %>
                </td>
                <td>${request.parameterName}</td>
                <td>${request.remark}</td>
                <td></td>
            </tr>
            <% } %>
            <tr class="bg myfont_weight">
                <td colspan="6">返回参数列表</td>
            </tr>
            <tr class="bg" align="center">
                <td class="myWidth">参数</td>
                <td class="myfont_weight">参数类型</td>
                <td class="myfont_weight">字段限制</td>
                <td class="myfont_weight">字段说明</td>
                <td class="myfont_weight">说明</td>
                <td class="myfont_weight">备注</td>
            </tr>
            <% for(var response in table.responseList) { %>
            <tr align="center">
                <td class="myWidth">${response.parameter}</td>
                <td>${response.type}</td>
                <td>
                    <% if (response.require!= null && response.require) { %>
                    必填
                    <% } else { %>
                    可选
                    <% } %>
                </td>
                <td>${response.parameterName}</td>
                <td>${response.remark}</td>
                <td></td>
            </tr>
            <% } %>
            <tr class="bg myfont_weight">
                <td colspan="6">示例</td>
            </tr>
            <tr class="specialHeight">
                <td class="bg myWidth">请求Header</td>
                <td colspan="5"></td>
            </tr>
            <tr class="specialHeight">
                <td class="bg myWidth">请求参数</td>
                <td class="json_class" colspan="5">${table.requestParam}</td>
            </tr>
            <tr class="specialHeight">
                <td class="bg myWidth">返回值</td>
                <td class="json_class" colspan="5">${table.responseParam}</td>
            </tr>
            <tr class="bg" align="center">
                <td class="myWidth">错误码</td>
                <td class="myfont_weight" colspan="5">描述</td>
            </tr>
            <tr align="center">
                <td class="myWidth"></td>
                <td colspan="5"></td>
            </tr>
            <tr align="center">
                <td class="myWidth"></td>
                <td colspan="5"></td>
            </tr>
            <!--     <tr align="center">
                     <td class="bg myWidth">状态码</td>
                     <td colspan="5" class="bg myfont_weight">说明</td>
                 </tr>
                 <tr align="center">
                     <td class="myWidth"></td>
                     <td colspan="5"></td>
                 </tr>-->
        </table>
    </div>
    <% } %>
</div>

<script type="text/javascript">
    window.onload = function (ev) {
        //格式化代码函数,已经用原生方式写好了不需要改动,直接引用就好
        var formatJson = function (json) {
            // debugger
            var formatted = '',     //转换后的json字符串
                padIdx = 0,         //换行后是否增减PADDING的标识
                PADDING = '    ';   //4个空格符
            /**
             * 将对象转化为string
             */
            if (typeof json !== 'string') {
                json = JSON.stringify(json);
            }
            /**
             *利用正则类似将{'parameter':'ccy','age':18,'info':['address':'wuhan','interest':'playCards']}
             *---> \r\n{\r\n'parameter':'ccy',\r\n'age':18,\r\n
             *'info':\r\n[\r\n'address':'wuhan',\r\n'interest':'playCards'\r\n]\r\n}\r\n
             */
            json = json.replace(/([\{\}])/g, '\r\n$1\r\n')
                .replace(/([\[\]])/g, '\r\n$1\r\n')
                .replace(/(\,)/g, '$1\r\n')
                .replace(/(\r\n\r\n)/g, '\r\n')
                .replace(/\r\n\,/g, ',');
            /**
             * 根据split生成数据进行遍历，一行行判断是否增减PADDING
             */
            (json.split('\r\n')).forEach(function (node, index) {
                var indent = 0,
                    padding = '';
                if (node.match(/\{$/) || node.match(/\[$/)) indent = 1;
                else if (node.match(/\}/) || node.match(/\]/)) padIdx = padIdx !== 0 ? --padIdx : padIdx;
                else indent = 0;
                for (var i = 0; i < padIdx; i++) padding += PADDING;
                formatted += padding + node + '\r\n';
                padIdx += indent;
                console.log('index:' + index + ',indent:' + indent + ',padIdx:' + padIdx + ',node-->' + node);
            });
            return formatted;
        };
        //引用示例部分
        //(1)创建json格式或者从后台拿到对应的json格式
        //var originalJson = {"parameter": "binginsist", "sex": "男", "age": "25"};
        //下面用一个真实的json数据做测试
        var originalJson = {
            "_errmsg": "ok",
            "result": [],
            "stat": "wechat",
            "_token": "",
            "weixinId": "900504",
            "_errcode": "0",
            "regionId": "00000000"
        }

        //(2)调用formatJson函数,将json格式进行格式化
        // var resultJson = formatJson(originalJson);
        //(3)将格式化好后的json写入页面中
        // $("#json_class").html('<pre>' +resultJson + '<pre/>');
        // var bankCard1=$(".json_class").text();
        // console.log('------111111-----', bankCard1)

        //(3)将格式化好后的json写入页面中
        var elList = document.querySelectorAll('.json_class');
        for (var i = 0; i < elList.length; i++) {
            var bankCard = document.querySelectorAll('.json_class')[i].innerText
            var resultJson = formatJson(bankCard);
            document.querySelectorAll('.json_class')[i].innerHTML = '<pre>' + resultJson + '<pre/>';
        }
        // $(".json_class").each(function (index, el) {
        //     // debugger
        //     var bankCard1=$(".json_class").eq(index).text()
        //     var resultJson = formatJson(bankCard1);
        //     console.log('------------', $(el), resultJson)
        //     $(el).html('<pre>' +resultJson + '<pre/>')
        // })
    }
</script>
</body>
</html>
